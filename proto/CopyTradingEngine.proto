syntax = "proto3";
import "google/protobuf/empty.proto";
package copy_trading;

enum AccountType{
    Provider = 0;
    Subscriber =1;
}

enum ResponseStatus{
    Ok = 0;
    ProviderAccountNotFound = 1;
    SubscriberAccountNotFound = 2;
}


message RegisterAccountRequest{
    string TraderId = 1;
    string ProcessId = 2;
    AccountType AccountType = 3;
}

message RegisterAccountResponse{
    string AccountId = 1;
}

message GetAccountsRequest{
    string TraderId = 1; 
} 

message CopyTradingAccount{
    string AccountId = 1;
    AccountType AccountType = 2;
    double Balance = 3;
}

message SubscribeToProviderRequest{
    string ProviderTraderId = 1;
    string ProviderAccountId = 2;
    string SubscriberTraderId = 3;
    string SubscriberAccountId = 4;
}

message UnSubscribeFromProviderRequest{
    string ProviderTraderId = 1;
    string ProviderAccountId = 2;
    string SubscriberTraderId = 3;
    string SubscriberAccountId = 4;
}

message SubscribeToProviderResponse{
    ResponseStatus Status = 1;
}

message UnSubscribeFromProviderResponse{
    ResponseStatus Status = 1;
}


message GetTopProvidersRequest{
    string TraderId = 1;
    int32 Skip = 2;
    int32 Take = 3;
}


message TopProviderAccount{
    string TraderId = 1;
    string AccountId = 2;
}


message GetSubscribersAmountRequest{
    string TraderId = 1;
}

message SubscriberAccountAmount{
    string TraderId = 1;
    string AccountId = 2;
    int32 Amount = 3;
}

service CopyTradingEngine {
    rpc RegisterAccount(RegisterAccountRequest) returns (RegisterAccountResponse);
    rpc GetAccounts(GetAccountsRequest) returns (stream CopyTradingAccount);

    rpc SubscribeToProvider(SubscribeToProviderRequest) returns (SubscribeToProviderResponse);
    rpc UnSubscribeFromProvider(UnSubscribeFromProviderRequest) returns (UnSubscribeFromProviderResponse);

    rpc GetTopProviders(GetTopProvidersRequest) returns (stream TopProviderAccount);

    rpc GetSubscribersAmount(GetSubscribersAmountRequest) returns (stream SubscriberAccountAmount);
    
    rpc Ping(google.protobuf.Empty) returns (google.protobuf.Empty);
}